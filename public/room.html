<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serenity Room</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Agbalumo&family=Amarante&family=Delicious+Handrawn&family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="theme-cafe"> <!-- Default Theme -->

    <div class="room-layout">

        <!-- Header Left - Room Name -->
        <div class="header-left bouncy">
            <span id="room-name-display">Room Name</span> üåø
        </div>

        <!-- Header Right - Buttons -->
        <div class="header-right bouncy">
            <button class="control-btn" id="theme-btn" title="Change Background"><i
                    class="fa-solid fa-image"></i></button>
            <button class="control-btn" id="exit-btn" title="Leave"><i class="fa-solid fa-door-open"></i></button>
        </div>

        <!-- Pomodoro Timer (Centered in Window Area) -->
        <div id="pomodoro-display" class="pomodoro-center">
            <span id="tiny-timer">25:00</span>
        </div>

        <!-- Main Desk Area (Compositing Anchor) -->
        <div id="desk" class="desk-container">
            <div id="desk-stage" class="desk-stage"></div>
        </div>

        <!-- Bottom Controls -->
        <footer class="room-controls bouncy">
            <button class="control-btn wobbly" id="timer-btn" title="Pomodoro"><i
                    class="fa-solid fa-clock"></i></button>
            <button class="control-btn wobbly" id="tasks-btn" title="Tasks"><i
                    class="fa-solid fa-list-check"></i></button>
            <button class="control-btn wobbly" id="chat-btn" title="Chat"><i class="fa-solid fa-comments"></i></button>
            <button class="control-btn wobbly" id="quiz-init-btn" title="Start Quiz"><i
                    class="fa-solid fa-brain"></i></button>
        </footer>

    </div>

    <!-- Pomodoro Window -->
    <div id="window-pomodoro" class="os-window hidden">
        <div class="window-header">
            <span class="window-title">Pomodoro üçÖ</span>
            <div class="window-controls">
                <button class="win-btn btn-minimize"><i class="fa-solid fa-minus"></i></button>
                <button class="win-btn btn-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>
        <div class="window-content">
            <div class="full-timer-ui">
                <h2 id="timer-mode" style="text-align:center; margin-bottom:10px;">Focus Mode üçÖ</h2>
                <div id="timer-display" class="timer-digits"
                    style="font-size: 3rem; text-align: center; margin: 10px 0;">25:00</div>
                <div class="timer-controls" style="display:flex; justify-content:center; gap:10px;">
                    <button id="start-timer" class="btn-primary" style="padding: 8px 20px;"><i
                            class="fa-solid fa-play"></i></button>
                    <button id="pause-timer" class="btn-primary"
                        style="display:none; background: #ffcc80; padding: 8px 20px;"><i
                            class="fa-solid fa-pause"></i></button>
                    <button id="reset-timer" class="control-btn" style="font-size: 1rem;"><i
                            class="fa-solid fa-rotate-right"></i></button>
                </div>
                <div class="timer-modes" style="margin-top:15px; display:flex; gap:5px; justify-content:center;">
                    <button class="mode-btn active" data-mode="focus">Focus</button>
                    <button class="mode-btn" data-mode="short-break">Short</button>
                    <button class="mode-btn" data-mode="long-break">Long</button>
                </div>
                <button id="toggle-settings" class="mode-btn" style="width:100%; margin-top: 15px; font-size:0.8rem;"><i
                        class="fa-solid fa-gear"></i> Settings</button>
                <div id="duration-settings" class="duration-inputs hidden"
                    style="background:#f9f9f9; padding:10px; border-radius:8px; margin-top:5px;">
                    <div class="duration-row"><label>Focus:</label><input type="number" id="focus-duration" value="25"
                            style="width:50px;"> min</div>
                    <div class="duration-row"><label>Short:</label><input type="number" id="short-break-duration"
                            value="5" style="width:50px;"> min</div>
                    <div class="duration-row"><label>Long:</label><input type="number" id="long-break-duration"
                            value="15" style="width:50px;"> min</div>
                    <button id="save-durations" class="btn-primary"
                        style="width:100%; margin-top:5px; font-size:0.8rem;">Save</button>
                </div>
            </div>
            <div class="mini-timer-ui">
                <span id="mini-timer-display">25:00</span>
            </div>
        </div>
    </div>

    <!-- Chat Window -->
    <div id="window-chat" class="os-window hidden">
        <div class="window-header">
            <span class="window-title">Chat üí¨</span>
            <div class="window-controls">
                <button class="win-btn btn-minimize"><i class="fa-solid fa-minus"></i></button>
                <button class="win-btn btn-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>
        <div class="window-content" style="display:flex; flex-direction:column; padding:0;">
            <div id="chat-messages" class="chat-messages" style="flex-grow:1; padding:15px; overflow-y:auto;">
                <!-- Messages will be added here -->
            </div>

            <div style="padding:10px; background:#fdfdfd; border-top:1px solid #eee;">
                <div class="chat-input-area" style="display:flex; gap:8px;">
                    <input type="text" id="chat-input" placeholder="Say something..." maxlength="200" autocomplete="off"
                        style="flex-grow:1; padding:8px; border-radius:20px; border:1px solid #ddd;">
                    <button id="send-chat" class="btn-primary"
                        style="padding: 8px 16px; font-size:0.9rem;">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Overlay -->
    <!-- Tasks Window -->
    <div id="window-tasks" class="os-window hidden">
        <div class="window-header">
            <span class="window-title">Tasks ‚úÖ</span>
            <div class="window-controls">
                <button class="win-btn btn-minimize"><i class="fa-solid fa-minus"></i></button>
                <button class="win-btn btn-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>
        <div class="window-content" style="display:flex; flex-direction:column; padding:0;">
            <p style="text-align:center; padding:10px; margin:0; font-size: 0.9rem; opacity: 0.8; background:#fafafa;">
                Goals for this session!</p>
            <ul id="task-list" class="task-list" style="flex-grow:1; overflow-y:auto; padding:0 10px;">
                <!-- Tasks injected here -->
            </ul>
            <div class="task-input-area"
                style="padding:10px; background:#fdfdfd; border-top:1px solid #eee; display:flex; gap:5px;">
                <input type="text" id="task-input" placeholder="Add task..." maxlength="50"
                    style="flex-grow:1; padding:8px; border-radius:15px; border:1px solid #ddd;">
                <button id="add-task-btn" class="btn-primary" style="padding: 8px 15px; font-size:1.2rem;">+</button>
            </div>
        </div>
    </div>

    <!-- Quiz Setup Overlay (Replaces God Mode) -->
    <div id="quiz-setup-overlay" class="overlay hidden">
        <div class="glass-panel modal-panel bouncy" style="max-width: 400px;">
            <button id="close-quiz-setup" class="close-btn"><i class="fa-solid fa-xmark"></i></button>
            <h2>Start a Quiz üß†</h2>
            <p style="text-align: center; opacity: 0.8; font-size: 0.9rem;">Challenge the room on any topic!</p>

            <div style="margin-top: 20px;">
                <input type="text" id="quiz-topic" placeholder="Values: Physics, Javascript, Cats..."
                    style="width: 100%; padding: 12px; border-radius: 12px; border: 2px solid var(--primary-light);">
                <button id="start-quiz-btn" class="btn-primary" style="width: 100%; margin-top: 10px;">
                    <i class="fa-solid fa-play"></i> Generate Quiz
                </button>
            </div>
        </div>
    </div>

    <!-- Quiz Window -->
    <div id="window-quiz" class="os-window hidden">
        <div class="window-header">
            <span class="window-title">Quiz Time üß†</span>
            <div class="window-controls">
                <button class="win-btn btn-minimize"><i class="fa-solid fa-minus"></i></button>
                <button class="win-btn btn-close"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>
        <div class="window-content">
            <!-- Active View -->
            <div id="quiz-active-view">
                <div class="quiz-header" style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <div class="quiz-badge" style="background:#fff3cd; padding:5px 10px; border-radius:10px;"><i
                            class="fa-solid fa-clipboard-question"></i> Quiz</div>
                    <div class="quiz-stats" style="font-weight:bold;">
                        <span id="quiz-counter">1 / 10</span>
                        <span id="quiz-score" style="margin-left:10px; color:#ffb7b2;"><i class="fa-solid fa-star"></i>
                            0</span>
                    </div>
                </div>

                <h2 id="quiz-question" style="font-size:1.2rem; margin-bottom:15px;">Question goes here?</h2>

                <div id="quiz-options" class="quiz-options" style="display:grid; position:relative;">
                    <!-- Options injected -->
                </div>

                <div class="quiz-timer-bar"
                    style="height:6px; background:#eee; margin-top:15px; border-radius:3px; overflow:hidden;">
                    <div id="quiz-progress" style="height:100%; background:var(--primary); width:100%;"></div>
                </div>
                <p id="quiz-status" style="text-align:center; font-size:0.9rem; margin-top:10px; height:20px;"></p>
            </div>

            <!-- Results View -->
            <div id="quiz-results-view" class="hidden" style="text-align:center;">
                <h2>üèÜ Quiz Complete! üèÜ</h2>
                <div id="quiz-leaderboard" style="max-height:200px; overflow-y:auto; margin:15px 0;">
                    <!-- Leaderboard items -->
                </div>
                <button id="close-quiz-results" class="btn-primary" style="margin-top: 20px;">Close üéâ</button>
            </div>
        </div>
    </div>

    <!-- Audio -->
    <audio id="notif-sound" src="/assets/notif.mp3"></audio>

    <!-- Generic Custom Modal -->
    <div id="custom-modal-overlay" class="overlay hidden" style="z-index: 2000;">
        <div class="glass-panel modal-panel bouncy">
            <h3 id="modal-title" style="margin-top:0;">Notice</h3>
            <p id="modal-message" style="margin: 1rem 0; color: #555;">Something happened!</p>
            <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="modal-cancel-btn" class="btn-secondary hidden">Cancel</button>
                <button id="modal-confirm-btn" class="btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="room.js"></script>
</body>

</html>